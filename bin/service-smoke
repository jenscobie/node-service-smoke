#! /usr/bin/env node

var fs = require('fs');
var program = require('commander');

program.name = 'service-smoke';

program
  .version(JSON.parse(fs.readFileSync(__dirname + '/../package.json', 'utf8')).version)

program
  .command('test [baseUrl]')
  .description('Run smoke tests against a service')
  .action(function(baseUrl) {
    baseUrl = baseUrl || 'http://docker:3000';
    process.env['SMOKE_TEST_BASE_URL'] = baseUrl;
    var shell = require("shelljs");
    var cmd = '(cd node_modules/service-smoke/ && npm test)';
    if (shell.exec(cmd).code !== 0) {
      process.exit(1);
    }
    process.exit(0);
  });

program.parse(process.argv);
